
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Editor Fundraiser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5dc;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .profile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }

        .profile-picture {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin-bottom: 15px;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .goal-text {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .goal-subtitle {
            color: #666;
            margin-bottom: 20px;
        }

        .coin-balance {
            background: white;
            border-radius: 20px;
            padding: 15px 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .coin-balance .amount {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4f46e5;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .amount-raised {
            font-size: 2.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .raised-label {
            color: #666;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e91e63, #f44336);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 30px;
        }

        .donate-btn {
            width: 100%;
            padding: 15px;
            background: #e91e63;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .convert-btn {
            width: 100%;
            padding: 15px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .tab-navigation {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #14b8a6;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .donation-form {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .amount-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .amount-btn {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .amount-btn:hover, .amount-btn.selected {
            border-color: #e91e63;
            background: #e91e63;
            color: white;
        }

        .custom-input, .name-input, .message-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .donator-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .donator-item:last-child {
            border-bottom: none;
        }

        .donator-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4f46e5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
        }

        .donator-info {
            flex: 1;
        }

        .donator-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .donator-message {
            color: #666;
            font-size: 0.9rem;
        }

        .donator-amount {
            font-weight: bold;
            color: #4caf50;
        }

        .incentive-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .incentive-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .incentive-amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .incentive-description {
            color: #666;
            font-size: 0.9rem;
        }

        .editor-doom-card {
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            color: white;
        }

        .daily-reward-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .reward-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .reward-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideInRight 0.5s ease;
            max-width: 350px;
        }

        .notification.doom {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: white;
        }

        .confirmation-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .popup-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            margin: 20px;
            text-align: center;
        }

        .popup-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .popup-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .popup-btn.confirm {
            background: #e91e63;
            color: white;
        }

        .popup-btn.cancel {
            background: #e5e7eb;
            color: #333;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 1000;
        }

        .connection-status.online {
            background: #10b981;
            color: white;
        }

        .connection-status.offline {
            background: #ef4444;
            color: white;
        }

        .hidden {
            display: none !important;
        }

        .file-input {
            display: none;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .rank-number {
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 15px;
            min-width: 30px;
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4f46e5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: bold;
        }

        .leaderboard-amount {
            font-weight: bold;
            color: #4caf50;
        }

        .total-count {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">🔌 Connecting...</div>
    
    <div class="container">
        <div class="header">
            <h1>🎬 Video Editor Fundraiser</h1>
        </div>

        <div class="profile-section">
            <div class="profile-picture" id="profilePicture" onclick="document.getElementById('fileInput').click()">
                🎬
            </div>
            <input type="file" id="fileInput" class="file-input" accept="image/*">
            
            <div class="goal-text">50 states. 50 days.</div>
            <div class="goal-text">1 guy.</div>
            <div class="goal-subtitle">The Million Dollar Road Trip</div>
            
            <div class="coin-balance">
                <div class="amount">💰 Your Coins: <span id="userCoins">50.0K</span></div>
            </div>
        </div>

        <div class="main-card">
            <div class="amount-raised" id="totalRaised">$0</div>
            <div class="raised-label">Raised</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            
            <div class="progress-labels">
                <span>$0</span>
                <span id="goalAmount">$1M</span>
            </div>

            <button class="donate-btn" onclick="showDonationForm()">Donate</button>
            <button class="convert-btn" onclick="showConvertConfirmation()">Convert Coins to Money</button>
        </div>

        <div class="daily-reward-section">
            <h3>🎁 Daily Reward</h3>
            <button class="reward-btn" id="dailyRewardBtn" onclick="claimDailyReward()">Claim 50,000 Coins</button>
            <div id="rewardTimer" style="margin-top: 10px; font-size: 0.9rem; color: #666;"></div>
        </div>

        <div class="tab-navigation">
            <button class="tab-btn active" onclick="showTab('donors')">Donors</button>
            <button class="tab-btn" onclick="showTab('incentives')">Incentives</button>
            <button class="tab-btn" onclick="showTab('leaderboard')">Leaderboard</button>
        </div>

        <div class="tab-content active" id="donors-tab">
            <div class="main-card">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="donator-avatar" style="width: 60px; height: 60px; margin: 0 auto 10px; font-size: 1.5rem;">👑</div>
                    <div style="font-weight: bold; font-size: 1.2rem;">Top Donor</div>
                    <div id="topDonorName" style="font-weight: bold;">Staple Games</div>
                    <div id="topDonorAmount" style="font-size: 1.5rem; font-weight: bold; color: #4caf50;">$0</div>
                </div>
                
                <div id="donorsList">
                    <div style="text-align: center; color: #666; padding: 20px;">No donations yet!</div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="incentives-tab">
            <div class="incentive-card editor-doom-card">
                <div class="incentive-icon">🎯</div>
                <div class="incentive-amount">$100,000</div>
                <div class="incentive-description">Select the Editor of Doom</div>
            </div>
            
            <div class="incentive-card">
                <div class="incentive-icon">🎪</div>
                <div class="incentive-amount">$50,000</div>
                <div class="incentive-description">Spin the Wheel of Doom</div>
            </div>
            
            <div class="incentive-card">
                <div class="incentive-icon">🙏</div>
                <div class="incentive-amount">$5,000</div>
                <div class="incentive-description">Verbal thank you</div>
            </div>
            
            <div class="incentive-card">
                <div class="incentive-icon">📺</div>
                <div class="incentive-amount">$1,000</div>
                <div class="incentive-description">Name on end-screen</div>
            </div>
        </div>

        <div class="tab-content" id="leaderboard-tab">
            <div class="total-count" id="totalDonorCount">0 total donors</div>
            <div id="leaderboardList">
                <div style="text-align: center; color: #666; padding: 20px;">No donations yet!</div>
            </div>
        </div>
    </div>

    <!-- Donation Form Modal -->
    <div id="donationModal" class="confirmation-popup hidden">
        <div class="popup-content donation-form">
            <h3>Make a Donation</h3>
            
            <div class="amount-grid">
                <div class="amount-btn" data-amount="1000">$1K</div>
                <div class="amount-btn" data-amount="5000">$5K</div>
                <div class="amount-btn" data-amount="10000">$10K</div>
                <div class="amount-btn" data-amount="25000">$25K</div>
                <div class="amount-btn" data-amount="50000">$50K</div>
                <div class="amount-btn" data-amount="100000">$100K</div>
            </div>
            
            <input type="number" class="custom-input" id="customAmount" placeholder="Enter custom amount ($)" min="1">
            <input type="text" class="name-input" id="donorName" placeholder="Enter your name (optional)">
            <input type="text" class="message-input" id="donorMessage" placeholder="Add a message (optional)">
            
            <div class="popup-buttons">
                <button class="popup-btn cancel" onclick="hideDonationForm()">Cancel</button>
                <button class="popup-btn confirm" id="submitDonation" onclick="processDonation()">Donate Now</button>
            </div>
        </div>
    </div>

    <!-- Convert Confirmation Modal -->
    <div id="convertModal" class="confirmation-popup hidden">
        <div class="popup-content">
            <h3>Convert Coins to Real Money?</h3>
            <p>This will reset your coin balance and the goal progress to $0. Are you sure you want to continue?</p>
            <div class="popup-buttons">
                <button class="popup-btn cancel" onclick="hideConvertConfirmation()">Cancel</button>
                <button class="popup-btn confirm" onclick="convertCoins()">Yes, Convert</button>
            </div>
        </div>
    </div>

    <!-- Editor of Doom Selection Modal -->
    <div id="editorDoomModal" class="confirmation-popup hidden">
        <div class="popup-content">
            <h3>🎯 Select Your Editor of Doom!</h3>
            <p>Choose your doom for the next video:</p>
            <select id="doomSelection" style="width: 100%; padding: 10px; margin: 15px 0; border-radius: 5px; border: 2px solid #e5e7eb;">
                <option value="">Choose your doom...</option>
                <option value="2 at a time">2 at a time - Make & Edit Another Video</option>
                <option value="Suitcase">Suitcase - you must edit anywhere and not same places</option>
                <option value="Boring..">Boring.. - You cannot do silly or funny parts in the video</option>
                <option value="Split">Split - You must edit 1 video in 2 editor and no bob</option>
                <option value="Secrets">Secrets - You cannot tell the viewer what editor is next</option>
                <option value="Broke">Broke - You must edit this video low budget</option>
                <option value="Golden ticket">Golden ticket - you can use anytime to skip wheel of doom, but it will last 24 hours if used</option>
                <option value="Patient">Patient - you must edit the video longer than 10 minutes</option>
                <option value="Decaf">Decaf - You cannot drink milk 24 hours</option>
                <option value="Lazy">Lazy - you must edit in a lazy way</option>
            </select>
            <div class="popup-buttons">
                <button class="popup-btn cancel" onclick="hideEditorDoomModal()">Cancel</button>
                <button class="popup-btn confirm" onclick="selectEditorDoom()">Select Doom</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, set, get, onValue, serverTimestamp, off } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAA9cKZi1r4W4ycxWj2OsvDaFmBKMQqCds",
            authDomain: "videoeditorfundraiser.firebaseapp.com",
            databaseURL: "https://videoeditorfundraiser-default-rtdb.firebaseio.com",
            projectId: "videoeditorfundraiser",
            storageBucket: "videoeditorfundraiser.firebasestorage.app",
            messagingSenderId: "470003540715",
            appId: "1:470003540715:web:75b8f2e66d5d7a93c294ae",
            measurementId: "G-4DDKZCPFL5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        class FundraiserApp {
            constructor() {
                this.totalRaised = 0;
                this.userCoins = 50000; // Starting coins
                this.donations = [];
                this.topDonators = [];
                this.currentGoal = 1000000;
                this.selectedAmount = 0;
                this.userId = this.generateUserId();
                this.isConnected = false;
                this.listeners = [];

                this.bindEvents();
                this.initializeFirebase();
                this.loadUserData();
                this.updateRewardTimer();
                setInterval(() => this.updateRewardTimer(), 1000);
            }

            generateUserId() {
                let userId = localStorage.getItem('fundraiser_user_id');
                if (!userId) {
                    userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
                    localStorage.setItem('fundraiser_user_id', userId);
                }
                return userId;
            }

            bindEvents() {
                // Amount selection
                document.querySelectorAll('.amount-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.selectedAmount = parseInt(btn.dataset.amount);
                        document.getElementById('customAmount').value = '';
                    });
                });

                // Custom amount input
                document.getElementById('customAmount').addEventListener('input', (e) => {
                    document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('selected'));
                    this.selectedAmount = parseInt(e.target.value) || 0;
                });

                // Profile picture upload
                document.getElementById('fileInput').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            document.getElementById('profilePicture').innerHTML = '';
                            document.getElementById('profilePicture').appendChild(img);
                            localStorage.setItem('profilePicture', e.target.result);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            async initializeFirebase() {
                try {
                    this.showConnectionStatus('connecting');
                    
                    await this.initializeDatabaseStructure();
                    this.setupRealtimeListeners();
                    
                    this.showConnectionStatus('online');
                    this.isConnected = true;
                } catch (error) {
                    console.error('Firebase initialization error:', error);
                    this.showConnectionStatus('offline');
                    this.isConnected = false;
                }
            }

            async initializeDatabaseStructure() {
                const statsRef = ref(db, 'stats');
                const snapshot = await get(statsRef);
                
                if (!snapshot.exists()) {
                    await set(ref(db, 'stats'), {
                        totalRaised: 0,
                        totalDonations: 0,
                        totalCoins: 0,
                        currentGoal: 1000000
                    });
                }
            }

            setupRealtimeListeners() {
                const statsRef = ref(db, 'stats');
                const statsListener = onValue(statsRef, (snapshot) => {
                    if (snapshot.exists()) {
                        const stats = snapshot.val();
                        this.totalRaised = stats.totalRaised || 0;
                        this.currentGoal = stats.currentGoal || 1000000;
                        this.updateDisplay();
                    }
                });

                const donationsRef = ref(db, 'donations');
                const donationsListener = onValue(donationsRef, (snapshot) => {
                    if (snapshot.exists()) {
                        const donationsData = snapshot.val();
                        this.donations = Object.values(donationsData).sort((a, b) => b.timestamp - a.timestamp);
                        this.updateDonorsDisplay();
                        this.updateLeaderboard();
                    } else {
                        this.donations = [];
                        this.updateDonorsDisplay();
                        this.updateLeaderboard();
                    }
                });

                this.listeners = [statsListener, donationsListener];
            }

            async processDonation() {
                if (this.selectedAmount <= 0) {
                    this.showNotification('Please select or enter a donation amount!');
                    return;
                }

                if (this.selectedAmount > this.userCoins) {
                    this.showNotification('Insufficient coins! You need more coins to make this donation.');
                    return;
                }

                if (!this.isConnected) {
                    this.showNotification('Cannot donate while offline. Please check your connection.');
                    return;
                }

                const donorName = document.getElementById('donorName').value.trim() || 'Anonymous';
                const donorMessage = document.getElementById('donorMessage').value.trim() || '';
                const timestamp = Date.now();

                try {
                    const donation = {
                        amount: this.selectedAmount,
                        donor: donorName,
                        message: donorMessage,
                        timestamp: timestamp,
                        userId: this.userId
                    };

                    // Add donation to Firebase
                    const donationsRef = ref(db, 'donations');
                    await push(donationsRef, donation);

                    // Update statistics
                    await this.updateStats(this.selectedAmount);

                    // Deduct coins from user
                    this.userCoins -= this.selectedAmount;
                    this.saveUserData();
                    this.updateUserCoinsDisplay();

                    // Check for Editor of Doom
                    if (this.selectedAmount >= 100000) {
                        this.showEditorDoomModal();
                    }

                    this.showNotification(`Thank you ${donorName}! You donated $${this.selectedAmount.toLocaleString()}!`);
                    this.hideDonationForm();
                    this.resetDonationForm();

                } catch (error) {
                    console.error('Donation error:', error);
                    this.showNotification('Failed to process donation. Please try again.');
                }
            }

            async updateStats(donationAmount) {
                const statsRef = ref(db, 'stats');
                const snapshot = await get(statsRef);
                const currentStats = snapshot.val() || {};

                const newStats = {
                    totalRaised: (currentStats.totalRaised || 0) + donationAmount,
                    totalDonations: (currentStats.totalDonations || 0) + 1,
                    totalCoins: (currentStats.totalCoins || 0) + donationAmount,
                    currentGoal: currentStats.currentGoal || 1000000
                };

                await set(statsRef, newStats);
            }

            async claimDailyReward() {
                const lastRewardTime = localStorage.getItem('lastRewardTime');
                const now = Date.now();
                const dayInMs = 24 * 60 * 60 * 1000;

                if (lastRewardTime && (now - parseInt(lastRewardTime)) < dayInMs) {
                    this.showNotification('Daily reward already claimed! Come back tomorrow.');
                    return;
                }

                this.userCoins += 50000;
                localStorage.setItem('lastRewardTime', now.toString());
                this.saveUserData();
                this.updateUserCoinsDisplay();
                
                this.showNotification('🎁 Daily reward claimed! +50,000 coins added to your balance!');
            }

            async convertCoins() {
                if (!this.isConnected) {
                    this.showNotification('Cannot convert coins while offline.');
                    return;
                }

                try {
                    // Reset total raised to 0
                    const statsRef = ref(db, 'stats');
                    await set(statsRef, {
                        totalRaised: 0,
                        totalDonations: 0,
                        totalCoins: 0,
                        currentGoal: 1000000
                    });

                    // Clear donations
                    const donationsRef = ref(db, 'donations');
                    await set(donationsRef, null);

                    this.hideConvertConfirmation();
                    this.showNotification('Successfully converted Coins to Real Money, Check your Bank Account!', true);
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    this.showNotification('Failed to convert coins. Please try again.');
                }
            }

            updateDisplay() {
                document.getElementById('totalRaised').textContent = '$' + this.formatNumber(this.totalRaised);
                document.getElementById('goalAmount').textContent = '$' + this.formatNumber(this.currentGoal);
                
                const progress = Math.min((this.totalRaised / this.currentGoal) * 100, 100);
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            updateUserCoinsDisplay() {
                document.getElementById('userCoins').textContent = this.formatNumber(this.userCoins);
            }

            updateDonorsDisplay() {
                const donorsList = document.getElementById('donorsList');
                
                if (this.donations.length === 0) {
                    donorsList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No donations yet!</div>';
                    document.getElementById('topDonorName').textContent = 'No donations yet';
                    document.getElementById('topDonorAmount').textContent = '$0';
                    return;
                }

                // Find top donor
                const topDonor = this.donations.reduce((max, donation) => 
                    donation.amount > max.amount ? donation : max, this.donations[0]);
                
                document.getElementById('topDonorName').textContent = topDonor.donor;
                document.getElementById('topDonorAmount').textContent = '$' + this.formatNumber(topDonor.amount);

                // Show recent donations
                const recentDonations = this.donations.slice(0, 10);
                donorsList.innerHTML = recentDonations.map(donation => `
                    <div class="donator-item">
                        <div class="donator-avatar">${donation.donor.charAt(0).toUpperCase()}</div>
                        <div class="donator-info">
                            <div class="donator-name">$${this.formatNumber(donation.amount)} - ${donation.donor}</div>
                            ${donation.message ? `<div class="donator-message">${donation.message}</div>` : ''}
                        </div>
                        <div class="donator-amount">${this.getTimeAgo(donation.timestamp)}</div>
                    </div>
                `).join('');
            }

            updateLeaderboard() {
                const leaderboardList = document.getElementById('leaderboardList');
                const totalDonorCount = document.getElementById('totalDonorCount');
                
                if (this.donations.length === 0) {
                    leaderboardList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No donations yet!</div>';
                    totalDonorCount.textContent = '0 total donors';
                    return;
                }

                // Aggregate donations by donor
                const donatorTotals = {};
                this.donations.forEach(donation => {
                    const donor = donation.donor;
                    donatorTotals[donor] = (donatorTotals[donor] || 0) + donation.amount;
                });

                // Convert to sorted array
                const sortedDonators = Object.entries(donatorTotals)
                    .map(([name, amount]) => ({ name, amount }))
                    .sort((a, b) => b.amount - a.amount);

                totalDonorCount.textContent = `${sortedDonators.length} total donors`;

                leaderboardList.innerHTML = sortedDonators.map((donator, index) => `
                    <div class="leaderboard-item">
                        <div class="rank-number">${index + 1}</div>
                        <div class="leaderboard-avatar">${donator.name.charAt(0).toUpperCase()}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${donator.name}</div>
                        </div>
                        <div class="leaderboard-amount">$${this.formatNumber(donator.amount)}</div>
                    </div>
                `).join('');
            }

            updateRewardTimer() {
                const lastRewardTime = localStorage.getItem('lastRewardTime');
                const rewardBtn = document.getElementById('dailyRewardBtn');
                const rewardTimer = document.getElementById('rewardTimer');
                
                if (!lastRewardTime) {
                    rewardTimer.textContent = 'Available now!';
                    rewardBtn.disabled = false;
                    return;
                }

                const now = Date.now();
                const lastClaimed = parseInt(lastRewardTime);
                const dayInMs = 24 * 60 * 60 * 1000;
                const timeSinceLastClaim = now - lastClaimed;

                if (timeSinceLastClaim >= dayInMs) {
                    rewardTimer.textContent = 'Available now!';
                    rewardBtn.disabled = false;
                } else {
                    const timeRemaining = dayInMs - timeSinceLastClaim;
                    const hours = Math.floor(timeRemaining / (60 * 60 * 1000));
                    const minutes = Math.floor((timeRemaining % (60 * 60 * 1000)) / (60 * 1000));
                    rewardTimer.textContent = `Next reward in: ${hours}h ${minutes}m`;
                    rewardBtn.disabled = true;
                }
            }

            loadUserData() {
                const savedCoins = localStorage.getItem('userCoins');
                if (savedCoins) {
                    this.userCoins = parseInt(savedCoins);
                }
                this.updateUserCoinsDisplay();

                const savedProfilePic = localStorage.getItem('profilePicture');
                if (savedProfilePic) {
                    const img = document.createElement('img');
                    img.src = savedProfilePic;
                    document.getElementById('profilePicture').innerHTML = '';
                    document.getElementById('profilePicture').appendChild(img);
                }
            }

            saveUserData() {
                localStorage.setItem('userCoins', this.userCoins.toString());
            }

            resetDonationForm() {
                this.selectedAmount = 0;
                document.getElementById('donorName').value = '';
                document.getElementById('donorMessage').value = '';
                document.getElementById('customAmount').value = '';
                document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('selected'));
            }

            showNotification(message, isSuccess = false) {
                const notification = document.createElement('div');
                notification.className = `notification ${isSuccess ? 'success' : ''}`;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }

            showConnectionStatus(status) {
                const statusElement = document.getElementById('connectionStatus');
                statusElement.className = `connection-status ${status}`;
                
                switch (status) {
                    case 'connecting':
                        statusElement.textContent = '🔌 Connecting...';
                        break;
                    case 'online':
                        statusElement.textContent = '🟢 Online';
                        break;
                    case 'offline':
                        statusElement.textContent = '🔴 Offline';
                        break;
                }
            }

            formatNumber(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                }
                if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                }
                return num.toString();
            }

            getTimeAgo(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return 'Just now';
            }
        }

        // Global functions for UI interactions
        window.showTab = function(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        };

        window.showDonationForm = function() {
            document.getElementById('donationModal').classList.remove('hidden');
        };

        window.hideDonationForm = function() {
            document.getElementById('donationModal').classList.add('hidden');
        };

        window.showConvertConfirmation = function() {
            document.getElementById('convertModal').classList.remove('hidden');
        };

        window.hideConvertConfirmation = function() {
            document.getElementById('convertModal').classList.add('hidden');
        };

        window.showEditorDoomModal = function() {
            document.getElementById('editorDoomModal').classList.remove('hidden');
        };

        window.hideEditorDoomModal = function() {
            document.getElementById('editorDoomModal').classList.add('hidden');
        };

        window.selectEditorDoom = function() {
            const selection = document.getElementById('doomSelection').value;
            if (selection) {
                window.fundraiserApp.showNotification(`🎯 Editor of Doom Selected: ${selection}! The chaos begins!`, true);
                window.hideEditorDoomModal();
            } else {
                window.fundraiserApp.showNotification('Please select a doom option first!');
            }
        };

        window.processDonation = function() {
            window.fundraiserApp.processDonation();
        };

        window.claimDailyReward = function() {
            window.fundraiserApp.claimDailyReward();
        };

        window.convertCoins = function() {
            window.fundraiserApp.convertCoins();
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            window.fundraiserApp = new FundraiserApp();
        });
    </script>
</body>
</html>
